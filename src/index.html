<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <style>
            body{
                margin: 0;
            }
            canvas{
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>

        <script src="https://cdn.bootcss.com/three.js/91/three.js"></script>
        <script>
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight, true);
            document.body.appendChild(renderer.domElement);

            var cubeCamera = new THREE.CubeCamera(1, 100000, 128);
            scene.add(cubeCamera);

            var g = new THREE.BoxGeometry(1,1,1);
            var m = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            var c = new THREE.Mesh(g, m);
            //c.position.set(10,0,0);
            //c.position.copy(new THREE.Vector3(5,15,0));
            c.quaternion.copy(new THREE.Vector4(12,2,2,2));
            // c.scale.set(2,10,3);
            scene.add(c);
            camera.position.set(5,20,20);
            camera.lookAt(new THREE.Vector3(0,0,0));

            camera.updateProjectionMatrix();
            console.log("CAMERA1:",camera.toJSON());
            cubeCamera.position.copy(c.position);
            cubeCamera.update(renderer, scene);

            var MAX_POINTS = 500;
            var geometry = new THREE.BufferGeometry();
            var positions = new Float32Array(MAX_POINTS * 3);
            geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3));

            var material = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 2 });

            var line = new THREE.Line(geometry, material);
            scene.add(line);

            var p = line.geometry.attributes.position.array;

            // 创建声音
//            var listener = new THREE.AudioListener();
//            camera.add(listener);
//
//            var sound = new THREE.PositionalAudio(listener);
//            var audioLoader = new THREE.AudioLoader();
//            audioLoader.load('assets/sound1.mp3', function(buffer){
//                sound.setBuffer(buffer);
//                sound.setLoop(true);
//                sound.setVolume(1.5);
//                sound.play();
//            });
//
//            var g1 = new THREE.SphereGeometry(10,12,8);
//            var m1 = new THREE.MeshBasicMaterial({ color: 0xff2200 });
//            var c1 = new THREE.Mesh(g1, m1);
//            scene.add(c1);
//            c1.add(sound);
            animate();


            function up() {
                var x, y, z, index;
                x = y = z = index = 0;

                for ( var i = 0, l = MAX_POINTS; i < l; i ++ ) {
                    x += ( Math.random() - 0.5 ) * 10;
                    y += ( Math.random() - 0.5 ) * 10;
                    z += ( Math.random() - 0.5 ) * 10;

                    p[ index ++ ] = x;
                    p[ index ++ ] = y;
                    p[ index ++ ] = z;
                }
            }
            up();

            // 渲染方法
            var j = 2;
            function animate() {
                requestAnimationFrame(animate);
                c.rotation.x += 0.01;
                c.rotation.y += 0.01;
                line.geometry.setDrawRange(0, j++);
                if(j>=8){
                    up();
                    line.geometry.attributes.position.needsUpdate = true;
                    j = 2;
                }

                renderer.render(scene, camera);
            }
        </script>
    </body>
</html>